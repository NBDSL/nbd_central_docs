.. _sec-water:

Water Perturbation Block in Pele++ control file
=====================================================

This block configures the Water Perturbation in a ``peleSimulation`` command. In a ``peleSimulation``, this phase will be active depending 
whether the ``WaterPerturbation`` block is present or not. If defined, an extra MC perturbation step focused on explicit water molecules will be performed after the ligand perturbation. This consists in a stochastic translation and rotation of the water molecules to a steric free location followed by a local minimization step. The new conformation is only accepted if it fulfils the metropolis criterium. The user can decide whether to move a single water molecules or more than one by defining them explicitely in the control file. In order to assess how many water molecules to use we are currently building a new methodology. 

Example
--------

The WaterPerturbation block can be defined inside the pele simulation command block section as next

.. code-block:: json

    {
        "commands": [{
            "commandType": "peleSimulation",

            "WaterPerturbation": {
                "Box": {
                    "radius": 10,
                    "fixedCenter": [14.505, -25.051, -1.524],
                    "type": "sphericalBox"
                },
                "watersToPerturb": {
                    "links": {
                        "ids": ["M:1"]
                    }
                },
                "parameters": {
                    "temperature": 500,
                    "numberOfStericTrials": 1000,
                    "COMConstraintConstant": 0.2
                }
            }
        }]
    }



Water selection
-------------------

WaterPerturbation works on a set of selected waters. To indicate the
desired water use the selection methods as seen below:

.. code-block:: json

    {
        "watersToPerturb": { "links": { "ids": [ "M:1" ] } }
    }


Parameters
--------------

.. code-block:: json

             {
             "parameters":
             {
                 "translationRange" : 5.0,
                 "overlapFactor" : 0.8,
                 "temperature": 500,
                 "numberOfStericTrials": 1000,
                 "COMConstraintConstant": 0.2
             }
             }

temperature
^^^^^^^^^^^^^^^^^^

The default temperature is 1000.
If higher sampling is desired increase the temperature until 2000 - 3000 (See 
`temperature <../SideChainPrediction/SideChainPrediction.html#temperature>`_).

- type: float

translationRange
^^^^^^^^^^^^^^^^^^

WaterPerturbation works by translating and minimazing the water molecule
at each PELE step. The tranlation range of the water molecules can be define with
``translationRange`` command.

- type: float

overlapFactor
^^^^^^^^^^^^^^^^^^

The default overlap factor is set to 0.8. Decrease that one to allow the waters
to move closer to the side chain atoms before minimization. (See `overlapFactor <../SideChainPrediction/SideChainPrediction.html#overlap-factor>`_)

- type: float

numberOfStericTrials
^^^^^^^^^^^^^^^^^^^^^
Default at 1000, increase that one when dealing with small pockets
that require big sidechain rearrengements to fit the water molecule 
(See `numberOfStericTrials <../Perturbation/Perturbation.html#sec-perturbation-parameters-numberofsterictrials>`_)

- type: int

COMConstraintConstant
^^^^^^^^^^^^^^^^^^^^^^^

Default at 0.2, increase the value to help the water to stay in the perturbed
place after minimization. (See `COMConstraintConstant <../PELE/PeleParameters.html#sec-peleparameters-perturbationcomconstraintconstant>`_)

- type: float
